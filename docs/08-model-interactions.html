<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>DATA / STAT 334 - 10&nbsp; Linear Model Visualization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./09-logistic.html" rel="next">
<link href="./07-stat213.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Linear Model Visualization</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">DATA / STAT 334</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Syllabus and Course Information</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Getting Started</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-choose-viz.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Choosing a Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-concepts.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Core Viz Concepts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-concepts-applied.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Applied Concepts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-software.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Software</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Visualization in R</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-statdata234.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">DATA/STAT 234 Review</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-mapping.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Mapping Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-uncertainty.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Expressing Variability/Uncertainty</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-other-topics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Other Topics</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Model Visualization</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-stat213.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">STAT 213 Review</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-model-interactions.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Linear Model Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-logistic.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Logistic Model Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-ethics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Ethics</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Interactive Visualization</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-when-to-use.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Introduction to Interactivity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-shiny-intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Introduction to <code>Shiny</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-shiny-reactivity.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Shiny Reactivity</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#introducing-modelr-class-prep" id="toc-introducing-modelr-class-prep" class="nav-link active" data-scroll-target="#introducing-modelr-class-prep"> <span class="header-section-number">10.1</span> Introducing <code>modelr</code> (Class Prep)</a></li>
  <li><a href="#visualizing-more-complex-models" id="toc-visualizing-more-complex-models" class="nav-link" data-scroll-target="#visualizing-more-complex-models"> <span class="header-section-number">10.2</span> Visualizing More Complex Models</a></li>
  <li><a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn"> <span class="header-section-number">10.3</span> Your Turn</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="modeviz" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Linear Model Visualization</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><p>The purpose of this section is to use the <code>modelr</code> package to visualize potentially complex linear models. We will begin with how to use the <code>modelr</code> package to visualize a linear regression model with a single quantitative predictor in order to see how the package works. We will then expand our usage to include models with categorical predictors, interaction terms, and quadratic (or higher order) terms.</p>
<p>Throughout this section, we will use a data set on course evaluations at the University of Texas Austin from the <code>openintro</code> package. Each row of the data set corresponds to a course at UT Austin. Variables that we will use include course evaluation <code>score</code> (on a 1-5 scale), <code>age</code> of professor, <code>bty_avg</code> (the attractiveness of the professor), <code>ethnicity</code> (either <code>minority</code> or <code>not minority</code>) and <code>gender</code> (either <code>male</code> or <code>female</code> in this data set).</p>
<div class="callout-note callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We will assume each observation is independent in our linear model. For those of you who have had STAT 313, it is more reasonable to fit a random intercepts model with <code>prof_id</code> as the random effect term, as each professor appears more than once in the data set (and it is likely that course scores for a professor are not independent).</p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://openintrostat.github.io/openintro/">openintro</a></span><span class="op">)</span></span>
<span><span class="va">evals</span></span>
<span><span class="co">#&gt; # A tibble: 463 × 23</span></span>
<span><span class="co">#&gt;   course_id prof_id score rank  ethnicity gender language   age cls_perc_eval</span></span>
<span><span class="co">#&gt;       &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;  &lt;fct&gt;    &lt;int&gt;         &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1         1       1   4.7 tenu… minority  female english     36          55.8</span></span>
<span><span class="co">#&gt; 2         2       1   4.1 tenu… minority  female english     36          68.8</span></span>
<span><span class="co">#&gt; 3         3       1   3.9 tenu… minority  female english     36          60.8</span></span>
<span><span class="co">#&gt; 4         4       1   4.8 tenu… minority  female english     36          62.6</span></span>
<span><span class="co">#&gt; 5         5       2   4.6 tenu… not mino… male   english     59          85  </span></span>
<span><span class="co">#&gt; 6         6       2   4.3 tenu… not mino… male   english     59          87.5</span></span>
<span><span class="co">#&gt; # ℹ 457 more rows</span></span>
<span><span class="co">#&gt; # ℹ 14 more variables: cls_did_eval &lt;int&gt;, cls_students &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   cls_level &lt;fct&gt;, cls_profs &lt;fct&gt;, cls_credits &lt;fct&gt;, bty_f1lower &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   bty_f1upper &lt;int&gt;, bty_f2upper &lt;int&gt;, bty_m1lower &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   bty_m1upper &lt;int&gt;, bty_m2upper &lt;int&gt;, bty_avg &lt;dbl&gt;, pic_outfit &lt;fct&gt;,</span></span>
<span><span class="co">#&gt; #   pic_color &lt;fct&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="introducing-modelr-class-prep" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="introducing-modelr-class-prep">
<span class="header-section-number">10.1</span> Introducing <code>modelr</code> (Class Prep)</h2>
<p>Our basic strategy for visualizing models is to</p>
<ol type="1">
<li><p>fit the model with <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code></p></li>
<li><p>construct a grid of predictor values with the <code><a href="https://modelr.tidyverse.org/reference/data_grid.html">data_grid()</a></code> function from the <code>modelr</code> package.</p></li>
<li><p>Use the <code><a href="https://modelr.tidyverse.org/reference/add_predictions.html">gather_predictions()</a></code> function from the <code>modelr</code> package to predict the response variable according to the model for each row in the grid.</p></li>
<li><p>Use <code>ggplot2</code> to construct a meaningful plot with the model predictions.</p></li>
</ol>
<p>We will begin by fitting a linear regression model with <code>score</code> as the response and <code>age</code> (in years) as the predictor. Note that we can easily visualize this model without <code>modelr</code> because of how simple it is:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">evals</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-model-interactions_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Our goal is to use <code>modelr</code> to recreate this plot so that we can see what the different functions are doing in a relatively simple example.</p>
<p><strong>Step 1</strong>: Fit the model.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span><span class="va">mod_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">score</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">evals</span><span class="op">)</span> </span>
<span><span class="va">mod_age</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 5</span></span>
<span><span class="co">#&gt;   term        estimate std.error statistic   p.value</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 (Intercept)  4.46      0.127       35.2  1.05e-132</span></span>
<span><span class="co">#&gt; 2 age         -0.00594   0.00257     -2.31 2.13e-  2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 2</strong>: Create a grid of predictor values.</p>
<p>In this simple example, we only have one predictor: <code>age</code>. So, we want to create a <code>tibble</code> that has a few values of <code>age</code> to plug into the fitted model. The <code><a href="https://modelr.tidyverse.org/reference/seq_range.html">seq_range()</a></code> function can help with this. In the code below, we are creating a <code>tibble</code> called <code>grid</code> that contains <code>6</code> values of <code>age</code>: the minimum <code>age</code> in <code>evals</code>, the maximum <code>age</code> in <code>evals</code>, and four other values that are equally spaced between the minimum and the maximum.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://modelr.tidyverse.org">modelr</a></span><span class="op">)</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="va">evals</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html">data_grid</a></span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://modelr.tidyverse.org/reference/seq_range.html">seq_range</a></span><span class="op">(</span><span class="va">age</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="va">grid</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 1</span></span>
<span><span class="co">#&gt;     age</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  29  </span></span>
<span><span class="co">#&gt; 2  37.8</span></span>
<span><span class="co">#&gt; 3  46.6</span></span>
<span><span class="co">#&gt; 4  55.4</span></span>
<span><span class="co">#&gt; 5  64.2</span></span>
<span><span class="co">#&gt; 6  73</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 3</strong>: <code><a href="https://modelr.tidyverse.org/reference/add_predictions.html">gather_predictions()</a></code>.</p>
<p>Next, we want to use the <code><a href="https://modelr.tidyverse.org/reference/add_predictions.html">gather_predictions()</a></code> function from <code>modelr</code> to use the <code>mod_age</code> model to predict course <code>score</code> for each row in <code>grid</code>. We will name this new <code>tibble</code> <code>model_df</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_df</span> <span class="op">&lt;-</span> <span class="va">grid</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://modelr.tidyverse.org/reference/add_predictions.html">gather_predictions</a></span><span class="op">(</span><span class="va">mod_age</span><span class="op">)</span></span>
<span><span class="va">model_df</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   model     age  pred</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 mod_age  29    4.29</span></span>
<span><span class="co">#&gt; 2 mod_age  37.8  4.24</span></span>
<span><span class="co">#&gt; 3 mod_age  46.6  4.19</span></span>
<span><span class="co">#&gt; 4 mod_age  55.4  4.13</span></span>
<span><span class="co">#&gt; 5 mod_age  64.2  4.08</span></span>
<span><span class="co">#&gt; 6 mod_age  73    4.03</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step 4</strong>: Use <code>ggplot2</code>.</p>
<p>The last step is to use <code>ggplot2</code> to make a meaningful plot. In this case, we can construct a plot with <code>pred</code> on the y-axis and <code>age</code> on the x-axis.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">model_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-model-interactions_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We get a plot of the fitted model. To plot the original data on top of the this plot,</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">model_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">1.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">evals</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">score</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="08-model-interactions_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-important callout callout-style-simple callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>This exercise is only to help us understand what some of the <code>modelr</code> functions are doing. For such a simple example, we would not go through the trouble of using <code>modelr</code> to create this plot when it can easily be created without it.</p>
</div>
</div>
<p><strong>Exercise 1</strong>. By “hand”, verify that the <code>pred</code> value in the first row of <code>model_df</code> can be calculated simply by plugging in <code>29</code> into the fitted regression equation obtained from <code>mod_age</code>.</p>
<p><strong>Exercise 2</strong>. In <code>data_grid(age = seq_range(age, n = 6))</code>, why does it not matter what value is chosen for <code>n</code> in this example (as long as <code>n</code> is greater than or equal to <code>2</code>)? Change <code>n</code> to be a different integer and verify that the plot does not change. Then, write a one to two sentence explanation of why the value of <code>n</code> does not matter here.</p>
<p><strong>Exercise 3</strong>. Fit the following model, which includes an <code>age^2</code> term. Then, run the rest of the code in the chunk to use <code>modelr</code> to obtain predictions for the <code>age</code> values in <code>grid</code> with both the <code>mod_age</code> model and the <code>mod_agesq</code> model. There are now 12 rows in <code>model_df</code>: 6 corresponding to predictions with the <code>mod_age</code> <code>model</code> and 6 corresponding to predictions with the <code>mod_agesq</code> <code>model</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod_agesq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">score</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">age</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">evals</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="va">evals</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html">data_grid</a></span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://modelr.tidyverse.org/reference/seq_range.html">seq_range</a></span><span class="op">(</span><span class="va">age</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="va">model_df</span> <span class="op">&lt;-</span> <span class="va">grid</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://modelr.tidyverse.org/reference/add_predictions.html">gather_predictions</a></span><span class="op">(</span><span class="va">mod_age</span>, <span class="va">mod_agesq</span><span class="op">)</span></span>
<span><span class="va">model_df</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 3</span></span>
<span><span class="co">#&gt;   model     age  pred</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 mod_age  29    4.29</span></span>
<span><span class="co">#&gt; 2 mod_age  37.8  4.24</span></span>
<span><span class="co">#&gt; 3 mod_age  46.6  4.19</span></span>
<span><span class="co">#&gt; 4 mod_age  55.4  4.13</span></span>
<span><span class="co">#&gt; 5 mod_age  64.2  4.08</span></span>
<span><span class="co">#&gt; 6 mod_age  73    4.03</span></span>
<span><span class="co">#&gt; # ℹ 6 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use <code>ggplot</code> to make a plot that has (1) the fitted line from <code>mod_age</code> and the fitted curve from <code>mod_agesq</code>, where the line/curves are coloured by the <code>model</code> type and (2) has the data points in the background of the plot.</p>
<p><strong>Exercise 4</strong>. In Exercise 3, explain why the choice of <code>n</code> matters more for this model. Then, change <code>n</code> from <code>6</code> to a value that is more reasonable and yields a nicer looking plot.</p>
</section><section id="visualizing-more-complex-models" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="visualizing-more-complex-models">
<span class="header-section-number">10.2</span> Visualizing More Complex Models</h2>
<p>The power of <code>modelr</code> (and this model visualization strategy in general) can really be seen in models where the coefficients are more challenging to interpret. For example, suppose that we fit the following model to the <code>evals</code> data:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mod_comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">score</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">bty_avg</span> <span class="op">+</span> <span class="va">age</span><span class="op">:</span><span class="va">bty_avg</span> <span class="op">+</span> <span class="va">gender</span>, data <span class="op">=</span> <span class="va">evals</span><span class="op">)</span></span>
<span><span class="va">mod_comp</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 5</span></span>
<span><span class="co">#&gt;   term        estimate std.error statistic  p.value</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 (Intercept)  5.24      0.362       14.5  2.08e-39</span></span>
<span><span class="co">#&gt; 2 age         -0.0308    0.00730     -4.22 2.91e- 5</span></span>
<span><span class="co">#&gt; 3 bty_avg     -0.204     0.0745      -2.74 6.48e- 3</span></span>
<span><span class="co">#&gt; 4 gendermale   0.213     0.0512       4.16 3.75e- 5</span></span>
<span><span class="co">#&gt; 5 age:bty_avg  0.00574   0.00156      3.69 2.53e- 4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The model contains an interaction between <code>age</code> and <code>bty_avg</code> so the coefficients involving these two terms are very tough to interpret. Our goal is to create a plot that helps interpret this model.</p>
<p>We will use the same strategy outlined in the previous section to create a data frame with predictions for various values of <code>age</code>, <code>bty_avg</code>, and <code>gender</code>. In <code><a href="https://modelr.tidyverse.org/reference/data_grid.html">data_grid()</a></code>, we now need to give values not only for <code>age</code>, but also for <code>bty_avg</code>, and <code>gender</code>. Note that <code>gender</code>, the categorical predictor is a vector of its possible levels.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="va">evals</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://modelr.tidyverse.org/reference/data_grid.html">data_grid</a></span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://modelr.tidyverse.org/reference/seq_range.html">seq_range</a></span><span class="op">(</span><span class="va">age</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>    bty_avg <span class="op">=</span> <span class="fu"><a href="https://modelr.tidyverse.org/reference/seq_range.html">seq_range</a></span><span class="op">(</span><span class="va">bty_avg</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>    gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="va">grid</span></span>
<span><span class="co">#&gt; # A tibble: 72 × 3</span></span>
<span><span class="co">#&gt;     age bty_avg gender</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1    29    1.67 female</span></span>
<span><span class="co">#&gt; 2    29    1.67 male  </span></span>
<span><span class="co">#&gt; 3    29    2.97 female</span></span>
<span><span class="co">#&gt; 4    29    2.97 male  </span></span>
<span><span class="co">#&gt; 5    29    4.27 female</span></span>
<span><span class="co">#&gt; 6    29    4.27 male  </span></span>
<span><span class="co">#&gt; # ℹ 66 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://modelr.tidyverse.org/reference/data_grid.html">data_grid()</a></code> creates one row for each <code>age</code>-<code>bty_avg</code>-<code>gender</code> combination. With 6 values for <code>age</code>, 6 values for <code>bty_avg</code>, and 2 values for <code>gender</code>, <code>grid</code> has 72 rows. We then gather the predictions from this <code>grid</code> with the <code>mod_comp</code> model:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_df</span> <span class="op">&lt;-</span> <span class="va">grid</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://modelr.tidyverse.org/reference/add_predictions.html">gather_predictions</a></span><span class="op">(</span><span class="va">mod_comp</span><span class="op">)</span></span>
<span><span class="va">model_df</span></span>
<span><span class="co">#&gt; # A tibble: 72 × 5</span></span>
<span><span class="co">#&gt;   model      age bty_avg gender  pred</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 mod_comp    29    1.67 female  4.29</span></span>
<span><span class="co">#&gt; 2 mod_comp    29    1.67 male    4.50</span></span>
<span><span class="co">#&gt; 3 mod_comp    29    2.97 female  4.24</span></span>
<span><span class="co">#&gt; 4 mod_comp    29    2.97 male    4.45</span></span>
<span><span class="co">#&gt; 5 mod_comp    29    4.27 female  4.19</span></span>
<span><span class="co">#&gt; 6 mod_comp    29    4.27 male    4.40</span></span>
<span><span class="co">#&gt; # ℹ 66 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And the final step is to create a plot of the resulting model predictions. This is the step that requires the most critical thinking, as the plot will change depending on (1) how many models we fit (just 1 in this example) and (2) how many predictor variables we have.</p>
<p><strong>Exercise 1</strong>. By hand, sketch a plot that shows the predictions from the <code>mod_comp</code> model in a meaningful way.</p>
<p><strong>Exercise 2</strong>. Make the plot that you sketched in the previous exercise.</p>
<div class="cell">

</div>
<p><strong>Exercise 3</strong>. Adjust one of the values for <code>n</code> to modify the plot in the previous exercise.</p>
<p><strong>Exercise 4</strong>. Look at the help in <code><a href="https://modelr.tidyverse.org/reference/seq_range.html">?seq_range</a></code> and use it to adjust the <code>trim</code> option for <code>age</code>.</p>
</section><section id="your-turn" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="your-turn">
<span class="header-section-number">10.3</span> Your Turn</h2>
<p><strong>Exercise 1</strong>. Fit a model of your choice with <strong>two</strong> categorical predictors, <strong>one</strong> quantitative predictor, and an interaction between the quantitative predictor and one of the categorical predictors. Construct a plot that helps interpret the coefficients from the fitted model.</p>
<p><strong>Exercise 2</strong>. Modify the model from the previous exercise by getting rid of the interaction term. Using <code>modelr</code>, construct a plot that compares the model with the interaction and the model without the interaction.</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./07-stat213.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">STAT 213 Review</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./09-logistic.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Logistic Model Visualization</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Course Materials were written by Matt Higham for STAT/DATA 334 at St.&nbsp;Lawrence University.</div>   
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>